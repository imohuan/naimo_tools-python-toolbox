import{d as S,u as P,r as V,q as B,a as n,p as z,e as a,b as l,k as u,E as N,F as i,T as R,m as f,n as m,t as c,h as $,o as s,z as O}from"./main.Dyol8uth.js";const A={class:"w-full h-full flex flex-col bg-white"},j={class:"opacity-60 flex-shrink-0 text-gray-500 select-none"},D={class:"flex-1 break-all whitespace-pre-wrap"},F={key:1,class:"my-1 bg-gray-100 rounded"},I=["onClick"],M={class:"opacity-60 flex-shrink-0 text-gray-500 select-none"},G={class:"flex-shrink-0"},q={key:0,class:"w-3.5 h-3.5 text-blue-600 animate-spin inline-block mt-0.5",fill:"none",viewBox:"0 0 24 24"},U={key:1,class:"text-green-600 font-bold"},W={key:2,class:"text-red-600 font-bold"},J={class:"flex-1 font-semibold text-gray-800"},K={key:0,class:"text-gray-500 font-normal text-xs ml-2"},Q={key:1,class:"text-gray-400 font-normal text-xs ml-2"},X={key:0},Y={class:"py-0.5 space-y-0.5"},Z={class:"opacity-60 flex-shrink-0 text-gray-500 select-none"},ee={class:"flex-1 break-all whitespace-pre-wrap"},te={class:"opacity-60 flex-shrink-0 text-gray-500 select-none"},se={class:"flex-1 break-all whitespace-pre-wrap"},ne={class:"opacity-60 flex-shrink-0 text-gray-500 select-none"},ae={class:"flex-1 break-all whitespace-pre-wrap"},oe={class:"opacity-60 flex-shrink-0 text-gray-500 select-none"},re={class:"flex-1 break-all whitespace-pre-wrap"},ce={key:0,class:"text-gray-400 text-center py-20"},_=5,ie=600,L=400,de=S({__name:"TerminalView",setup(le){const v=N(),d=P(),y=V();function p(t){return{info:"text-gray-700",success:"text-green-600",warning:"text-yellow-600",error:"text-red-600","command-group":"text-blue-700"}[t]||"text-gray-700"}function w(t){return{running:"bg-blue-50 hover:bg-blue-100",success:"bg-emerald-50 hover:bg-emerald-100",error:"bg-rose-50 hover:bg-rose-100"}[t]||"bg-gray-100 hover:bg-gray-150"}function k(t){if(!t.commandLogs||t.commandLogs.length===0)return{lineCount:0,charCount:0};const o=t.commandLogs.length,e=t.commandLogs.reduce((g,r)=>g+r.message.length,0);return{lineCount:o,charCount:e}}function x(t){const{lineCount:o,charCount:e}=k(t);return o>_||e>ie}function C(t){const{lineCount:o}=k(t);return o>_}function b(t,o){return t?t.slice(-5):[]}function T(t){if(!t.commandLogs||t.commandLogs.length===0)return"";const o=t.commandLogs.map(e=>e.message).join(`
`);return o.length<=L?o:`…${o.slice(-L)}`}function E(t){return!t.commandLogs||t.commandLogs.length===0?"info":t.commandLogs[t.commandLogs.length-1].type}function H(t){return!t.commandLogs||t.commandLogs.length===0?t.time:t.commandLogs[t.commandLogs.length-1].time}return B(()=>d.logs.length,()=>{O(()=>{y.value&&(y.value.scrollTop=y.value.scrollHeight)})},{deep:!0}),(t,o)=>(s(),n(i,null,[(s(),z(R,{to:"#tab-actions"},[u(v).path==="/terminal"?(s(),n(i,{key:0},[u(d).logs.length>0?(s(),n("button",{key:0,onClick:o[0]||(o[0]=e=>u(d).clear()),class:"px-2.5 py-1.5 text-xs text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors font-medium"}," 清空日志 ")):l("",!0)],64)):l("",!0)])),a("div",A,[a("div",{ref_key:"terminalRef",ref:y,class:"flex-1 overflow-y-auto p-4 space-y-0.5 font-mono text-xs"},[(s(!0),n(i,null,f(u(d).logs,(e,g)=>(s(),n(i,{key:g},[e.type!=="command-group"?(s(),n("div",{key:0,class:m(["flex items-start gap-3",p(e.type)])},[a("span",j,c(e.time),1),a("span",D,c(e.message),1)],2)):(s(),n("div",F,[a("div",{onClick:r=>e.commandLogs&&x(e)?u(d).toggleCommandCollapse(e.commandId):null,class:m(["flex items-start gap-3 py-1 transition-colors sticky z-20",[w(e.status),e.commandLogs&&x(e)?"cursor-pointer":""]]),style:{top:"-1rem"}},[a("span",M,c(e.time),1),e.commandLogs&&x(e)?(s(),n("svg",{key:0,class:m(["w-3 h-3 flex-shrink-0 transition-transform mt-0.5 text-gray-600",e.collapsed?"":"rotate-90"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...o[1]||(o[1]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M9 5l7 7-7 7"},null,-1)])],2)):l("",!0),a("span",G,[e.status==="running"?(s(),n("svg",q,[...o[2]||(o[2]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):e.status==="success"?(s(),n("span",U,"✓")):e.status==="error"?(s(),n("span",W,"✗")):l("",!0)]),a("span",J,[$(c(e.command)+" ",1),e.exitCode!==void 0?(s(),n("span",K," (退出码: "+c(e.exitCode)+") ",1)):l("",!0),e.commandLogs&&e.commandLogs.length>5?(s(),n("span",Q,c(e.commandLogs.length)+" 行 ",1)):l("",!0)])],10,I),e.commandLogs&&e.commandLogs.length>0?(s(),n("div",X,[a("div",Y,[x(e)?(s(),n(i,{key:1},[e.collapsed?(s(),n(i,{key:0},[C(e)?(s(!0),n(i,{key:0},f(b(e.commandLogs),(r,h)=>(s(),n("div",{key:`cmd-${h}`,class:m(["flex items-start gap-3",p(r.type)])},[a("span",te,c(r.time),1),a("span",se,c(r.message),1)],2))),128)):(s(),n("div",{key:1,class:m(["flex items-start gap-3",p(E(e))])},[a("span",ne,c(H(e)),1),a("span",ae,c(T(e)),1)],2))],64)):(s(!0),n(i,{key:1},f(e.commandLogs,(r,h)=>(s(),n("div",{key:`cmd-${h}`,class:m(["flex items-start gap-3",p(r.type)])},[a("span",oe,c(r.time),1),a("span",re,c(r.message),1)],2))),128))],64)):(s(!0),n(i,{key:0},f(e.commandLogs,(r,h)=>(s(),n("div",{key:`cmd-${h}`,class:m(["flex items-start gap-3",p(r.type)])},[a("span",Z,c(r.time),1),a("span",ee,c(r.message),1)],2))),128))])])):l("",!0)]))],64))),128)),u(d).logs.length===0?(s(),n("div",ce,[...o[3]||(o[3]=[a("svg",{class:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),a("p",{class:"text-sm"},"暂无日志",-1)])])):l("",!0)],512)])],64))}});export{de as default};
