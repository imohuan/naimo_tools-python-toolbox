import{I as z,r as s}from"./main.Dyol8uth.js";const C=z("python",()=>{const r=s({pythonVersion:null,pipVersion:null,uvVersion:null,pythonPath:null,hasUpdate:!1}),l=s([]),V=s("win-x64"),c=s(!1),f=s(!1),a=s(new Set),u=s(new Set),p=t=>t.toLowerCase();function h(t,e){const n=i=>i.replace(/^v/,"").split(".").map(U=>parseInt(U)||0),o=n(t),g=n(e);for(let i=0;i<Math.max(o.length,g.length);i++){const w=o[i]||0,y=g[i]||0;if(w<y)return-1;if(w>y)return 1}return 0}function d(){if(r.value.pythonVersion&&l.value.length>0){const t=l.value.find(e=>!e.isPreRelease);t&&(r.value.hasUpdate=h(r.value.pythonVersion,t.version)<0)}}async function I(){c.value=!0;try{if(!window.pythonToolboxAPI)return console.error("pythonToolboxAPI 不可用"),!1;const t=await window.pythonToolboxAPI.getEnvironmentInfo();return r.value={pythonVersion:t.pythonVersion,pipVersion:t.pipVersion,uvVersion:t.uvVersion,pythonPath:t.pythonPath,hasUpdate:!1},d(),x(),!0}catch(t){return console.error("获取 Python 信息失败:",t),!1}finally{c.value=!1}}async function v(t=!1){if(!window.pythonToolboxAPI?.getPipSupportedOptions)return!1;if(!t&&a.value.size>0)return!0;try{const e=await window.pythonToolboxAPI.getPipSupportedOptions();return a.value=new Set(e.options.map(n=>p(n))),!0}catch(e){return console.error("获取 pip 选项信息失败:",e),!1}}async function P(t=!1){if(!window.pythonToolboxAPI?.getUvSupportedOptions)return!1;if(!t&&u.value.size>0)return!0;try{const e=await window.pythonToolboxAPI.getUvSupportedOptions();return u.value=new Set(e.options.map(n=>p(n))),!0}catch(e){return console.error("获取 uv 选项信息失败:",e),!1}}async function x(){await Promise.all([v(),P()])}function $(t){return a.value.size===0?!0:a.value.has(p(t))}function S(t){return u.value.size===0?!0:u.value.has(p(t))}function A(t){return r.value.pipVersion?h(r.value.pipVersion,t)>=0:!0}function b(t){return r.value.uvVersion?h(r.value.uvVersion,t)>=0:!0}async function O(){f.value=!0;try{if(!window.pythonToolboxAPI)return console.error("pythonToolboxAPI 不存在"),!1;const t=await window.pythonToolboxAPI.getPythonVersions();return l.value=t.slice(0,20).map(e=>{try{const n=m(e.version);return{...e,url:n.url}}catch{return{...e,url:""}}}),d(),!0}catch(t){return console.error("获取版本列表失败:",t),!1}finally{f.value=!1}}function T(){const t=navigator.userAgent.toLowerCase(),e=navigator.platform.toLowerCase();return e.includes("win")?"win-x64":e.includes("mac")||t.includes("mac")?t.includes("arm")||e.includes("arm")?"darwin-arm64":"darwin-x64":e.includes("linux")||t.includes("linux")?t.includes("arm")||e.includes("arm")?"linux-arm64":"linux-x64":"win-x64"}function m(t){const e=T();let n,o;if(e==="win-x64")n=`python-${t}-amd64.exe`,o=`https://www.python.org/ftp/python/${t}/${n}`;else if(e==="win-x86")n=`python-${t}.exe`,o=`https://www.python.org/ftp/python/${t}/${n}`;else if(e==="win-arm64")n=`python-${t}-arm64.exe`,o=`https://www.python.org/ftp/python/${t}/${n}`;else if(e.startsWith("darwin"))n=`python-${t}-macos11.pkg`,o=`https://www.python.org/ftp/python/${t}/${n}`;else if(e==="linux-x64")n=`Python-${t}.tgz`,o=`https://www.python.org/ftp/python/${t}/${n}`;else if(e==="linux-arm64")n=`Python-${t}.tgz`,o=`https://www.python.org/ftp/python/${t}/${n}`;else throw new Error(`不支持的平台: ${e}`);return{url:o,filename:n}}return{pythonInfo:r,versions:l,selectedPlatform:V,isLoadingInfo:c,isLoadingVersions:f,pipSupportedOptions:a,uvSupportedOptions:u,fetchPythonInfo:I,fetchVersions:O,getDownloadInfo:m,fetchPipCliOptions:v,fetchUvCliOptions:P,ensureCliOptions:x,isPipOptionSupported:$,isUvOptionSupported:S,isPipVersionAtLeast:A,isUvVersionAtLeast:b}});export{C as u};
