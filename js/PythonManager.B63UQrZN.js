import{u as J}from"./python.CFDplgS4.js";import{d as G,r as _,c as v,a as n,n as k,b as M,e,f as Q,t as f,g as W,F as $,h as H,o as r,s as X,u as Y,i as Z,j as P,_ as E,w as ee,k as D,l as te,m as L,p as A}from"./main.Dyol8uth.js";const oe=["disabled"],ae={class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},se={class:"relative z-10 flex flex-1 items-center justify-between gap-2"},re={class:"text-left"},ne={class:"text-[11px] text-gray-500"},le={class:"mt-0.5 font-mono text-base font-semibold text-gray-900"},ie={class:"mt-1 flex h-4 items-center text-[11px] text-gray-500"},de={class:"font-mono text-gray-700"},ue={class:"font-mono text-gray-700"},ce={class:"relative flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-md"},I=G({__name:"DownloadButton",props:{url:{},filename:{},version:{},date:{default:""},label:{default:"版本"},variant:{default:"lts"},tagText:{default:"下载"},tagVariant:{default:"stable"}},emits:["downloadStart","downloadComplete","downloadError"],setup(h,{emit:b}){const u=h,m=b,c=_(!1),p=_(0),d=_(0),C=_(0),y=_(0),l=_(""),z=v(()=>c.value?"border-blue-400/80 bg-blue-50/20 cursor-wait":u.variant==="lts"?"hover:border-emerald-400/80":"hover:border-indigo-400/80"),g=v(()=>{const i="bg-gradient-to-br";return u.variant==="lts"?`${i} from-emerald-500 to-teal-500`:`${i} from-indigo-500 to-blue-500`}),w=v(()=>u.variant==="lts"?"text-emerald-500":"text-indigo-500"),V=v(()=>u.variant==="lts"?"bg-gradient-to-r from-emerald-400 to-teal-400":"bg-gradient-to-r from-indigo-400 to-blue-400"),T=v(()=>{switch(u.tagVariant){case"latest":return"bg-indigo-500";case"preview":return"bg-orange-500";default:return"bg-emerald-500"}});function B(i){if(i===0)return"0 B";const s=1024,x=["B","KB","MB","GB"],t=Math.floor(Math.log(i)/Math.log(s));return Math.round(i/Math.pow(s,t)*100)/100+" "+x[t]}async function j(){if(c.value)return;c.value=!0,p.value=0,d.value=0,C.value=0,y.value=0,l.value="",m("downloadStart",u.version);let i=null,s=null,x=null;const t=()=>{i?.(),s?.(),x?.(),l.value=""};try{i=naimo.download.onDownloadProgress(o=>{console.log("Progress event:",l.value,o),l.value&&o.id===l.value&&(console.log("Updating progress:",o.progress),p.value=o.progress,d.value=o.bytesReceived,C.value=o.totalBytes,y.value=o.downloadRate)}),s=naimo.download.onDownloadCompleted(async o=>{if(console.log("Completed event:",l.value,o),l.value&&o.id===l.value){p.value=100,c.value=!1,t();try{await naimo.shell.openPath(o.filePath)}catch(S){console.error("打开文件失败:",S)}m("downloadComplete",o.filePath)}}),x=naimo.download.onDownloadError(o=>{console.log("Error event:",l.value,o),l.value&&o.id===l.value&&(c.value=!1,t(),m("downloadError",o.error))});const a=await naimo.download.startDownload({url:u.url,saveAsFilename:u.filename});if(console.log("Download started with ID:",a),!a)throw new Error("下载启动失败：未获取到下载 ID");l.value=a}catch(a){console.error("Download error:",a),c.value=!1,t(),m("downloadError",String(a))}}return(i,s)=>(r(),n("button",{onClick:j,disabled:c.value,class:k(["relative flex w-full items-center gap-2 overflow-hidden rounded-lg border border-transparent bg-gray-50 px-3 py-2 transition-colors duration-200",z.value])},[c.value?(r(),n("div",{key:0,class:k(["absolute inset-0 opacity-15 transition-all duration-300",V.value]),style:Q({width:p.value+"%"})},null,6)):M("",!0),e("div",{class:k(["pointer-events-none absolute -right-7 top-2 flex h-5 w-24 rotate-45 items-center justify-center text-[10px] font-semibold tracking-wide text-white shadow-sm",T.value])},f(c.value?"下载中":h.tagText),3),e("div",{class:k(["relative z-10 flex h-9 w-9 flex-shrink-0 items-center justify-center rounded-md text-white",g.value])},[(r(),n("svg",ae,[W(i.$slots,"icon",{},()=>[s[0]||(s[0]=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1))])]))],2),e("div",se,[e("div",re,[e("p",ne,f(h.label),1),e("p",le,f(h.version),1),e("div",ie,[c.value?(r(),n($,{key:1},[e("span",de,f(p.value.toFixed(1))+"%",1),s[1]||(s[1]=e("span",{class:"mx-1 text-gray-400"},"•",-1)),e("span",ue,f(B(y.value))+"/s",1)],64)):(r(),n($,{key:0},[H(f(h.date),1)],64))])]),e("div",ce,[c.value?(r(),n("svg",{key:1,class:k(["h-4 w-4 animate-spin",w.value]),viewBox:"0 0 24 24"},[...s[3]||(s[3]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3",fill:"none"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])],2)):(r(),n("svg",{key:0,class:k(["h-4 w-4 transition-transform",w.value]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...s[2]||(s[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])],2))])])],10,oe))}}),ve={class:"w-full h-full overflow-auto"},ge={class:"p-2 space-y-2"},fe={class:"border border-gray-200 rounded-lg bg-white"},me={class:"flex items-center justify-between px-3 py-2 bg-gray-50 border-b border-gray-200"},xe={class:"flex items-center gap-2"},pe={class:"p-2 space-y-2"},ye={class:"grid grid-cols-2 gap-2"},he={class:"p-2 rounded bg-gray-50/50"},be={class:"text-sm font-semibold text-indigo-600"},we={class:"p-2 rounded bg-gray-50/50"},_e={class:"text-sm font-semibold text-green-600"},ke={class:"p-2 rounded bg-gray-50/50"},De={class:"text-sm font-semibold text-blue-600"},Ce={class:"p-2 rounded bg-gray-50/50"},Ve={class:"text-[10px] text-gray-600 truncate"},Pe={class:"border border-gray-200 rounded-lg bg-white"},$e={class:"flex items-center justify-between px-3 py-2 bg-gray-50 border-b border-gray-200"},Be={class:"flex items-center gap-2"},Se={class:"p-2 space-y-2"},Me={class:"px-2 space-y-3"},ze={key:0,class:"rounded-lg border border-dashed border-gray-200 px-3 py-4 text-center"},Te={key:0},je={key:1,class:"space-y-2"},Ee={class:"grid grid-cols-1 gap-2 sm:grid-cols-2"},Ie={key:2,class:"space-y-2"},Re={class:"grid grid-cols-1 gap-2 sm:grid-cols-2"},Ne={key:2,class:"rounded-lg border border-dashed border-gray-200 px-3 py-4 text-center text-xs text-gray-400"},Ae=G({__name:"PythonManager",setup(h){const b=J(),{pythonInfo:u,versions:m,isLoadingInfo:c,isLoadingVersions:p}=X(b),d=Y();function C(t,a){const o=U=>U.split(".").map(q=>Number.parseInt(q)||0),[S,R,K]=o(t.version),[N,F,O]=o(a.version);return S!==N?N-S:R!==F?F-R:(O||0)-(K||0)}function y(t,a){try{return{...b.getDownloadInfo(t.version),version:t.version,date:t.releaseDate?new Date(t.releaseDate).toLocaleDateString("zh-CN"):"",tagText:a.tagText,tagVariant:a.tagVariant,variant:a.variant}}catch(o){return console.error("获取下载信息失败:",o),null}}const l=v(()=>m.value.filter(t=>!t.isPreRelease).slice().sort(C)),z=v(()=>m.value.filter(t=>t.isPreRelease).slice().sort(C)),g=v(()=>{const t=l.value[0];return t?y(t,{tagText:"最新",tagVariant:"latest",variant:"current"}):null}),w=v(()=>l.value.slice(1,5).map(t=>y(t,{tagText:"稳定",tagVariant:"stable",variant:"lts"})).filter(t=>!!t)),V=v(()=>z.value.slice(0,4).map(t=>y(t,{tagText:"预览",tagVariant:"preview",variant:"current"})).filter(t=>!!t)),T=v(()=>!!(g.value||w.value.length||V.value.length));async function B(){try{d.info("正在检测 Python 环境..."),await b.fetchPythonInfo()?d.success("环境检测完成"):d.error("环境检测失败")}catch(t){d.error(`环境检测失败：${t.message}`)}}async function j(){try{d.info("正在获取 Python 版本列表..."),await b.fetchVersions()?d.success(`已加载 ${m.value.length} 个版本信息`):d.error("获取版本列表失败")}catch(t){d.error(`获取版本列表失败：${t.message}`)}}function i(t){d.info(`开始下载 Python ${t}...`)}function s(t){d.success(`下载完成：${t}`)}function x(t){d.error(`下载失败：${t}`)}return Z(async()=>{await B(),await j()}),(t,a)=>(r(),n("div",ve,[e("div",ge,[e("div",fe,[e("div",me,[e("div",xe,[P(E,{name:"server",size:"xs",class:"text-gray-500"}),a[0]||(a[0]=e("h3",{class:"text-xs font-semibold text-gray-700"},"Python 环境",-1))]),P(te,{onClick:B,loading:D(c),size:"xs"},{default:ee(()=>[P(E,{name:"refresh",size:"xs"}),a[1]||(a[1]=H(" 刷新 ",-1))]),_:1},8,["loading"])]),e("div",pe,[e("div",ye,[e("div",he,[a[2]||(a[2]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Python 版本",-1)),e("div",be,f(D(u).pythonVersion||"未安装"),1)]),e("div",we,[a[3]||(a[3]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"pip 版本",-1)),e("div",_e,f(D(u).pipVersion||"未安装"),1)]),e("div",ke,[a[4]||(a[4]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"uv 版本",-1)),e("div",De,f(D(u).uvVersion||"未安装"),1)]),e("div",Ce,[a[5]||(a[5]=e("label",{class:"block text-xs font-medium text-gray-600 mb-1"},"Python 路径",-1)),e("div",Ve,f(D(u).pythonPath||"-"),1)])])])]),e("div",Pe,[e("div",$e,[e("div",Be,[P(E,{name:"download",size:"xs",class:"text-gray-500"}),a[6]||(a[6]=e("h3",{class:"text-xs font-semibold text-gray-700"},"Python 下载",-1))])]),e("div",Se,[a[10]||(a[10]=e("p",{class:"text-xs text-gray-500 px-2"}," 从官方网站下载最新版本的 Python ",-1)),e("div",Me,[D(p)?(r(),n("div",ze,[...a[7]||(a[7]=[e("div",{class:"flex items-center justify-center gap-2 text-xs text-gray-500"},[e("div",{class:"w-3 h-3 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}),e("span",null,"正在加载 Python 版本列表...")],-1)])])):T.value?(r(),n($,{key:1},[g.value?(r(),n("div",Te,[P(I,{url:g.value.url,filename:g.value.filename,version:g.value.version,date:g.value.date,label:"最新稳定版本",variant:"current","tag-text":g.value.tagText,"tag-variant":g.value.tagVariant,onDownloadStart:i,onDownloadComplete:s,onDownloadError:x},null,8,["url","filename","version","date","tag-text","tag-variant"])])):M("",!0),w.value.length?(r(),n("div",je,[a[8]||(a[8]=e("div",{class:"px-1 text-[12px] font-medium text-gray-500"}," 其他稳定版本 ",-1)),e("div",Ee,[(r(!0),n($,null,L(w.value,o=>(r(),A(I,{key:`stable-${o.version}`,url:o.url,filename:o.filename,version:o.version,date:o.date,label:"稳定版本",variant:"lts","tag-text":o.tagText,"tag-variant":o.tagVariant,onDownloadStart:i,onDownloadComplete:s,onDownloadError:x},null,8,["url","filename","version","date","tag-text","tag-variant"]))),128))])])):M("",!0),V.value.length?(r(),n("div",Ie,[a[9]||(a[9]=e("div",{class:"px-1 text-[12px] font-medium text-gray-500"}," 最新预览版本 ",-1)),e("div",Re,[(r(!0),n($,null,L(V.value,o=>(r(),A(I,{key:`preview-${o.version}`,url:o.url,filename:o.filename,version:o.version,date:o.date,label:"预览版本",variant:"current","tag-text":o.tagText,"tag-variant":o.tagVariant,onDownloadStart:i,onDownloadComplete:s,onDownloadError:x},null,8,["url","filename","version","date","tag-text","tag-variant"]))),128))])])):M("",!0)],64)):(r(),n("div",Ne," 暂无可用的下载版本，请稍后再试 "))])])])])]))}});export{Ae as default};
